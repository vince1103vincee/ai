
 LangChain | Ollama + Function Calling

  å®Œæ•´çš„æµç¨‹

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                    MCP Server                               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            â†“

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  æ„å»º messages                                               â”‚
  â”‚                                                              â”‚
  â”‚  role: "system"                                             â”‚
  â”‚  â”œâ”€ "ä½ æ˜¯äº§å“æŸ¥è¯¢åŠ©æ‰‹"                                      â”‚
  â”‚  â”œâ”€ "ä½ æœ‰è¿™äº›å·¥å…·ï¼š"                                        â”‚
  â”‚  â”‚  â”œâ”€ get_all_products                                    â”‚
  â”‚  â”‚  â”œâ”€ get_product                                         â”‚
  â”‚  â”‚  â”œâ”€ search_products_by_name                             â”‚
  â”‚  â”‚  â””â”€ ... (14 ä¸ªå·¥å…·)                                      â”‚
  â”‚  â””â”€ "å½“ä½ éœ€è¦å·¥å…·æ—¶ï¼Œç”¨ <tool_call>...</tool_call> æ ¼å¼"   â”‚
  â”‚                                                              â”‚
  â”‚  role: "user"                                               â”‚
  â”‚  â””â”€ "please list me all the product"                       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            â†“

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                    Ollama                                    â”‚
  â”‚                                                              â”‚
  â”‚  ğŸ¤– æˆ‘æ¥åˆ¤æ–­ï¼š                                              â”‚
  â”‚  1ï¸âƒ£ ç”¨æˆ·è¦ä»€ä¹ˆï¼Ÿâ†’ åˆ—å‡ºæ‰€æœ‰äº§å“                             â”‚
  â”‚  2ï¸âƒ£ æˆ‘æœ‰ä»€ä¹ˆå·¥å…·ï¼Ÿâ†’ çœ‹ system prompt                      â”‚
  â”‚  3ï¸âƒ£ å“ªä¸ªå·¥å…·é€‚åˆï¼Ÿâ†’ get_all_products!                      â”‚
  â”‚  4ï¸âƒ£ æ€ä¹ˆè°ƒç”¨ï¼Ÿâ†’ æŒ‰ç…§ system prompt çš„æ ¼å¼                â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            â†“

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Ollama è¿”å›çš„å“åº”ï¼ˆinitial_responseï¼‰                      â”‚
  â”‚                                                              â”‚
  â”‚  <tool_call>                                                â”‚
  â”‚  {"name": "get_all_products", "arguments": {"limit": 100}} â”‚
  â”‚  </tool_call>                                               â”‚
  â”‚                                                              â”‚
  â”‚  I'll retrieve all products for you.                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            â†“

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  _extract_tool_calls(initial_response)                      â”‚
  â”‚                                                              â”‚
  â”‚  ğŸ” ç”¨æ­£åˆ™è¡¨è¾¾å¼æå– <tool_call>...</tool_call> å—         â”‚
  â”‚                                                              â”‚
  â”‚  è¿”å›ï¼š                                                      â”‚
  â”‚  [                                                           â”‚
  â”‚    {                                                         â”‚
  â”‚      "name": "get_all_products",                            â”‚
  â”‚      "arguments": {"limit": 100}                            â”‚
  â”‚    }                                                         â”‚
  â”‚  ]                                                           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            â†“

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  tools.execute_tool("get_all_products", {"limit": 100})    â”‚
  â”‚                                                              â”‚
  â”‚  â†’ api_client.get_all_products(limit=100)                   â”‚
  â”‚  â†’ requests.get("http://localhost:8000/products")           â”‚
  â”‚  â†’ Flask API è¿”å›äº§å“åˆ—è¡¨                                   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜