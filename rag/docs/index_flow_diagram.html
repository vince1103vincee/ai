<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>/index å‘½ä»¤æµç¨‹åœ– - RAG System</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        nav {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab-button {
            padding: 12px 24px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            color: #667eea;
            font-weight: 600;
        }

        .tab-button:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .tab-button.active {
            background: #667eea;
            color: white;
        }

        .content {
            padding: 40px;
        }

        .diagram-section {
            display: none;
        }

        .diagram-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-size: 2rem;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .section-description {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
        }

        .mermaid {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        footer {
            background: #2d3748;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .code-location {
            font-family: 'Courier New', monospace;
            background: #f1f3f5;
            padding: 2px 6px;
            border-radius: 4px;
            color: #667eea;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ” /index å‘½ä»¤æµç¨‹åœ–</h1>
            <p class="subtitle">RAG System - å®Œæ•´åŸ·è¡Œæµç¨‹è©³è§£</p>
        </header>

        <nav>
            <button class="tab-button active" onclick="showTab('overview')">ç¸½è¦½</button>
            <button class="tab-button" onclick="showTab('detailed')">è©³ç´°æµç¨‹</button>
            <button class="tab-button" onclick="showTab('dataflow')">æ•¸æ“šæµè½‰</button>
            <button class="tab-button" onclick="showTab('callstack')">èª¿ç”¨å †ç–Š</button>
            <button class="tab-button" onclick="showTab('fileinteraction')">æª”æ¡ˆäº’å‹•</button>
            <button class="tab-button" onclick="showTab('simple')">ç°¡åŒ–ç‰ˆ</button>
        </nav>

        <div class="content">
            <!-- ç¸½è¦½ -->
            <div id="overview" class="diagram-section active">
                <h2 class="section-title">ğŸ“Š ä¸»æµç¨‹åœ–ï¼ˆé«˜éšè¦–åœ–ï¼‰</h2>
                <div class="section-description">
                    <p>é€™å€‹æµç¨‹åœ–å±•ç¤ºäº†å¾ç”¨æˆ¶è¼¸å…¥ <code>/index ./demo_docs</code> åˆ°å®Œæˆç´¢å¼•çš„ä¸»è¦æ­¥é©Ÿã€‚</p>
                    <p>åŒ…å«å‘½ä»¤è§£æã€ç›®éŒ„é©—è­‰ã€æ–‡ä»¶è™•ç†ã€åˆ†å¡Šã€å‘é‡åŒ–ç­‰æ ¸å¿ƒéšæ®µã€‚</p>
                </div>
                <div class="mermaid">
flowchart TD
    Start([ç”¨æˆ¶è¼¸å…¥: /index ./demo_docs]) --> Input[rag_bot.py:146<br/>æ¥æ”¶è¼¸å…¥]
    Input --> Check{rag_bot.py:155<br/>æ˜¯å‘½ä»¤?}
    Check -->|Yes| Parse[rag_bot.py:156<br/>åˆ†å‰²å‘½ä»¤åƒæ•¸]
    Check -->|No| Query[è™•ç†ä¸€èˆ¬æŸ¥è©¢]

    Parse --> Match{rag_bot.py:169<br/>åŒ¹é… /index?}
    Match -->|Yes| Extract[rag_bot.py:175-176<br/>æå–åƒæ•¸<br/>directory='./demo_docs'<br/>pattern='*.txt']
    Match -->|No| Other[è™•ç†å…¶ä»–å‘½ä»¤]

    Extract --> Call1[rag_bot.py:177<br/>bot.index_directory<br/>directory, pattern]

    Call1 --> DirCheck{rag_bot.py:63<br/>ç›®éŒ„å­˜åœ¨?}
    DirCheck -->|No| Error1[é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯]
    DirCheck -->|Yes| Call2[rag_bot.py:68<br/>engine.index_from_directory<br/>directory, pattern]

    Call2 --> CreateProc[rag_engine.py:61-64<br/>å‰µå»º DocumentProcessor<br/>chunk_size=500<br/>chunk_overlap=50]

    CreateProc --> LoadProc[rag_engine.py:66-68<br/>processor.load_and_process_directory<br/>directory, pattern]

    LoadProc --> AddDocs[rag_engine.py:70<br/>vector_store.add_documents<br/>chunk_texts, chunk_metadata]

    AddDocs --> SetFlag[rag_bot.py:69<br/>index_loaded = True]
    SetFlag --> End([å®Œæˆ!])

    style Start fill:#e1f5e1
    style End fill:#e1f5e1
    style Error1 fill:#ffe1e1
                </div>
            </div>

            <!-- è©³ç´°æµç¨‹ -->
            <div id="detailed" class="diagram-section">
                <h2 class="section-title">ğŸ”¬ è©³ç´°æµç¨‹åœ–ï¼ˆåŒ…å«æ‰€æœ‰å­æµç¨‹ï¼‰</h2>
                <div class="section-description">
                    <p>é€™å€‹æµç¨‹åœ–å±•ç¤ºäº†å…­å€‹ä¸»è¦éšæ®µçš„è©³ç´°åŸ·è¡Œæ­¥é©Ÿï¼ŒåŒ…å«æ‰€æœ‰é‡è¦çš„ä»£ç¢¼ä½ç½®ã€‚</p>
                    <p><strong>å…­å¤§éšæ®µï¼š</strong></p>
                    <ol style="margin-left: 20px; margin-top: 10px;">
                        <li>å‘½ä»¤è§£æ <span class="code-location">rag_bot.py</span></li>
                        <li>ç›®éŒ„é©—è­‰ <span class="code-location">rag_bot.py</span></li>
                        <li>æ–‡ä»¶è™•ç†å™¨åˆå§‹åŒ– <span class="code-location">rag_engine.py</span></li>
                        <li>è¼‰å…¥æ–‡ä»¶ <span class="code-location">document_processor.py</span></li>
                        <li>æ–‡æœ¬åˆ†å¡Š <span class="code-location">document_processor.py</span></li>
                        <li>å‘é‡åŒ–èˆ‡å„²å­˜ <span class="code-location">vector_store.py</span></li>
                    </ol>
                </div>
                <div class="mermaid">
flowchart TD
    Start([ç”¨æˆ¶è¼¸å…¥: /index ./demo_docs]) --> Phase1[ç¬¬ä¸€éšæ®µ: å‘½ä»¤è§£æ]

    subgraph Phase1_Detail[ç¬¬ä¸€éšæ®µ: å‘½ä»¤è§£æ rag_bot.py]
        P1_1[line:146 input æ¥æ”¶è¼¸å…¥]
        P1_2[line:155 æª¢æŸ¥ startswith'/']
        P1_3[line:156 split maxsplit=2]
        P1_4[line:169 åŒ¹é… /index]
        P1_5[line:175 directory = parts1]
        P1_6[line:176 pattern = parts2 or '*.txt']
        P1_7[line:177 å‘¼å« bot.index_directory]

        P1_1 --> P1_2 --> P1_3 --> P1_4 --> P1_5 --> P1_6 --> P1_7
    end

    Phase1 --> Phase2[ç¬¬äºŒéšæ®µ: ç›®éŒ„é©—è­‰]

    subgraph Phase2_Detail[ç¬¬äºŒéšæ®µ: ç›®éŒ„é©—è­‰ rag_bot.py]
        P2_1[line:61 é€²å…¥ index_directory]
        P2_2[line:63 os.path.exists directory]
        P2_3{ç›®éŒ„å­˜åœ¨?}
        P2_4[line:68 å‘¼å« engine.index_from_directory]
        P2_5[line:69 è¨­ç½® index_loaded = True]

        P2_1 --> P2_2 --> P2_3
        P2_3 -->|Yes| P2_4 --> P2_5
        P2_3 -->|No| P2_Error[line:64 é¡¯ç¤ºéŒ¯èª¤]
    end

    Phase2 --> Phase3[ç¬¬ä¸‰éšæ®µ: æ–‡ä»¶è™•ç†å™¨åˆå§‹åŒ–]

    subgraph Phase3_Detail[ç¬¬ä¸‰éšæ®µ: RAG Engine rag_engine.py]
        P3_1[line:45 é€²å…¥ index_from_directory]
        P3_2[line:61-64 å‰µå»º DocumentProcessor<br/>chunk_size=500<br/>chunk_overlap=50]
        P3_3[line:66-68 å‘¼å«<br/>processor.load_and_process_directory]
        P3_4[line:70 å‘¼å«<br/>vector_store.add_documents]

        P3_1 --> P3_2 --> P3_3 --> P3_4
    end

    Phase3 --> Complete([å®Œæˆç´¢å¼•!])

    style Start fill:#e1f5e1
    style Complete fill:#e1f5e1
    style P2_Error fill:#ffe1e1
                </div>
            </div>

            <!-- æ•¸æ“šæµè½‰ -->
            <div id="dataflow" class="diagram-section">
                <h2 class="section-title">ğŸ”„ æ•¸æ“šæµè½‰åœ–</h2>
                <div class="section-description">
                    <p>é€™å€‹æµç¨‹åœ–å±•ç¤ºäº†æ•¸æ“šå¦‚ä½•å¾è¼¸å…¥å‘½ä»¤è½‰æ›ç‚ºå‘é‡å„²å­˜ã€‚</p>
                    <p>è¿½è¹¤æ•¸æ“šå¾æ–‡ä»¶ç³»çµ± â†’ æ–‡ä»¶å°è±¡ â†’ åˆ†å¡Š â†’ åµŒå…¥å‘é‡ â†’ å‘é‡å„²å­˜åº«çš„å®Œæ•´æµç¨‹ã€‚</p>
                </div>
                <div class="mermaid">
flowchart LR
    subgraph Input[è¼¸å…¥æ•¸æ“š]
        I1["/index ./demo_docs"]
        I2["directory = './demo_docs'<br/>pattern = '*.txt'"]
    end

    subgraph Files[æ–‡ä»¶ç³»çµ±]
        F1[python_basics.txt<br/>567 å­—å…ƒ]
        F2[machine_learning.txt<br/>621 å­—å…ƒ]
        F3[rag_systems.txt<br/>685 å­—å…ƒ]
        F4[wovenid.txt]
    end

    subgraph Documents[æ–‡ä»¶å°è±¡]
        D1["{'text': '...', 'metadata': {...}}"]
        D2["{'text': '...', 'metadata': {...}}"]
        D3["{'text': '...', 'metadata': {...}}"]
        D4["{'text': '...', 'metadata': {...}}"]
    end

    subgraph Chunks[åˆ†å¡Šçµæœ]
        C1[Chunk 0: 0-500 å­—å…ƒ]
        C2[Chunk 1: 450-567 å­—å…ƒ]
        C3[Chunk 2: 0-500 å­—å…ƒ]
        C4[Chunk 3: 450-621 å­—å…ƒ]
        C5[...]
        C6[Chunk 14]
    end

    subgraph Embeddings[å‘é‡åµŒå…¥]
        E1["[0.123, -0.456, ..., 0.789]<br/>768 ç¶­å‘é‡"]
        E2["[0.234, -0.567, ..., 0.890]<br/>768 ç¶­å‘é‡"]
        E3["[...]"]
        E4["å…± 15 å€‹å‘é‡"]
    end

    subgraph VectorStore[å‘é‡å„²å­˜åº«]
        V1[documents: List 15]
        V2[embeddings: List 15]
        V3[metadata: List 15]
    end

    I1 --> I2
    I2 --> Files

    F1 --> D1
    F2 --> D2
    F3 --> D3
    F4 --> D4

    D1 --> C1
    D1 --> C2
    D2 --> C3
    D2 --> C4
    D3 --> C5
    D4 --> C6

    C1 --> E1
    C2 --> E2
    C3 --> E3
    C4 --> E4

    E1 --> V1
    E1 --> V2
    C1 --> V3

    E2 --> V1
    E2 --> V2
    C2 --> V3

    style Input fill:#e3f2fd
    style Files fill:#fff3e0
    style Documents fill:#f3e5f5
    style Chunks fill:#e8f5e9
    style Embeddings fill:#fce4ec
    style VectorStore fill:#e1f5e1
                </div>
            </div>

            <!-- èª¿ç”¨å †ç–Š -->
            <div id="callstack" class="diagram-section">
                <h2 class="section-title">ğŸ“š å‡½æ•¸èª¿ç”¨å †ç–Šåœ–</h2>
                <div class="section-description">
                    <p>é€™å€‹æµç¨‹åœ–å±•ç¤ºäº†å‡½æ•¸ä¹‹é–“çš„èª¿ç”¨é—œä¿‚ï¼Œåˆ†ç‚ºä¸‰å€‹ä¸»è¦éšæ®µã€‚</p>
                    <p>å¯ä»¥çœ‹åˆ°å¾ä¸»å¾ªç’°åˆ°æœ€çµ‚å‘¼å« Ollama API çš„å®Œæ•´èª¿ç”¨éˆã€‚</p>
                </div>
                <div class="mermaid">
flowchart TB
    subgraph Stack["èª¿ç”¨å †ç–Šï¼ˆè¼‰å…¥éšæ®µï¼‰"]
        direction TB
        S1["main() - rag_bot.py:123"]
        S2["while True - rag_bot.py:144"]
        S3["input() - rag_bot.py:146"]
        S4["bot.index_directory() - rag_bot.py:177"]
        S5["engine.index_from_directory() - rag_bot.py:68"]
        S6["processor.load_and_process_directory() - rag_engine.py:66"]
        S7["load_directory() - document_processor.py:144"]
        S8["load_text_file() - document_processor.py:92"]

        S1 --> S2 --> S3 --> S4 --> S5 --> S6 --> S7 --> S8
    end

    subgraph Stack2["èª¿ç”¨å †ç–Šï¼ˆåˆ†å¡Šéšæ®µï¼‰"]
        direction TB
        T1["process_documents() - document_processor.py:148"]
        T2["chunk_text() - document_processor.py:123"]
        T3["while start < len(text) - document_processor.py:36"]

        T1 --> T2 --> T3
    end

    subgraph Stack3["èª¿ç”¨å †ç–Šï¼ˆå‘é‡åŒ–éšæ®µï¼‰"]
        direction TB
        U1["vector_store.add_documents() - rag_engine.py:70"]
        U2["_get_embedding() - vector_store.py:38"]
        U3["client.embeddings() - vector_store.py:21"]
        U4["Ollama API HTTP POST"]

        U1 --> U2 --> U3 --> U4
    end

    Stack --> Stack2 --> Stack3
                </div>
            </div>

            <!-- æª”æ¡ˆäº’å‹• -->
            <div id="fileinteraction" class="diagram-section">
                <h2 class="section-title">ğŸ—‚ï¸ æª”æ¡ˆäº’å‹•åœ–</h2>
                <div class="section-description">
                    <p>é€™å€‹æµç¨‹åœ–å±•ç¤ºäº†å„å€‹ Python æª”æ¡ˆä¹‹é–“çš„å”ä½œé—œä¿‚ã€‚</p>
                    <p>å¯ä»¥çœ‹åˆ° rag_bot.pyã€rag_engine.pyã€document_processor.pyã€vector_store.py å¦‚ä½•äº’ç›¸é…åˆã€‚</p>
                </div>
                <div class="mermaid">
graph LR
    subgraph UserInput[ç”¨æˆ¶è¼¸å…¥]
        UI[/index ./demo_docs]
    end

    subgraph RagBot[rag_bot.py]
        RB1[main 123-246]
        RB2[index_directory 61-73]
    end

    subgraph RagEngine[rag_engine.py]
        RE1[index_from_directory 45-70]
    end

    subgraph DocProc[document_processor.py]
        DP1[load_and_process_directory 132-151]
        DP2[load_directory 75-105]
        DP3[load_text_file 70-73]
        DP4[process_documents 107-130]
        DP5[chunk_text 19-68]
    end

    subgraph VecStore[vector_store.py]
        VS1[add_documents 30-47]
        VS2[_get_embedding 18-28]
    end

    subgraph FileSystem[æ–‡ä»¶ç³»çµ±]
        FS1[demo_docs/python_basics.txt]
        FS2[demo_docs/machine_learning.txt]
        FS3[demo_docs/rag_systems.txt]
        FS4[demo_docs/wovenid.txt]
    end

    subgraph OllamaAPI[Ollama API]
        OA1[POST /api/embeddings]
    end

    UI --> RB1
    RB1 --> RB2
    RB2 --> RE1
    RE1 --> DP1
    DP1 --> DP2
    DP2 --> DP3
    DP3 --> FS1
    DP3 --> FS2
    DP3 --> FS3
    DP3 --> FS4
    DP1 --> DP4
    DP4 --> DP5
    RE1 --> VS1
    VS1 --> VS2
    VS2 --> OA1

    style UserInput fill:#e1f5e1
    style FileSystem fill:#fff3e0
    style OllamaAPI fill:#e3f2fd
                </div>
            </div>

            <!-- ç°¡åŒ–ç‰ˆ -->
            <div id="simple" class="diagram-section">
                <h2 class="section-title">âœ¨ ç°¡åŒ–ç‰ˆæµç¨‹åœ–ï¼ˆä¸€é è¦–åœ–ï¼‰</h2>
                <div class="section-description">
                    <p>é€™æ˜¯æœ€ç°¡åŒ–çš„æµç¨‹åœ–ï¼Œé©åˆå¿«é€Ÿç†è§£æ•´é«”æµç¨‹ã€‚</p>
                    <p>å¾ç”¨æˆ¶è¼¸å…¥åˆ°å®Œæˆç´¢å¼•ï¼Œä¸€ç›®äº†ç„¶ï¼</p>
                </div>
                <div class="mermaid">
flowchart TD
    Start([ğŸ‘¤ ç”¨æˆ¶è¼¸å…¥<br/>/index ./demo_docs])

    Start --> A[ğŸ“ è§£æå‘½ä»¤<br/>rag_bot.py:156<br/>æå– directory å’Œ pattern]

    A --> B[âœ… é©—è­‰ç›®éŒ„<br/>rag_bot.py:63<br/>æª¢æŸ¥ ./demo_docs å­˜åœ¨]

    B --> C[ğŸ”§ åˆå§‹åŒ–è™•ç†å™¨<br/>rag_engine.py:61<br/>DocumentProcessor<br/>chunk_size=500, overlap=50]

    C --> D[ğŸ“‚ è¼‰å…¥æ–‡ä»¶<br/>document_processor.py:89<br/>æƒæ *.txt æ–‡ä»¶<br/>æ‰¾åˆ° 4 å€‹æ–‡ä»¶]

    D --> E[ğŸ“„ è®€å–å…§å®¹<br/>document_processor.py:72<br/>è®€å–æ¯å€‹æ–‡ä»¶çš„æ–‡æœ¬]

    E --> F[âœ‚ï¸ æ–‡æœ¬åˆ†å¡Š<br/>document_processor.py:36<br/>500 å­—å…ƒ/å¡Šï¼Œ50 å­—å…ƒé‡ç–Š<br/>ç”¢ç”Ÿ 15 å€‹ chunks]

    F --> G[ğŸ”¢ å‘é‡åŒ–<br/>vector_store.py:21<br/>å‘¼å« Ollama API<br/>ç”Ÿæˆ 768 ç¶­å‘é‡]

    G --> H[ğŸ’¾ å„²å­˜<br/>vector_store.py:40-42<br/>å„²å­˜åˆ°ä¸‰å€‹åˆ—è¡¨<br/>documents, embeddings, metadata]

    H --> End([âœ… å®Œæˆç´¢å¼•<br/>index_loaded = True])

    style Start fill:#e1f5e1
    style End fill:#e1f5e1
    style D fill:#fff3e0
    style G fill:#e3f2fd
                </div>
            </div>
        </div>

        <footer>
            <p>ğŸ“š RAG System Flow Diagrams | ä½¿ç”¨ Mermaid ç¹ªè£½ | 2025</p>
            <p style="margin-top: 10px; opacity: 0.8;">æ‰€æœ‰ä»£ç¢¼ä½ç½®éƒ½ç¶“éé©—è­‰ï¼Œå¯ä»¥ç›´æ¥è·³è½‰åˆ°å°æ‡‰æ–‡ä»¶æŸ¥çœ‹</p>
        </footer>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // Tab switching
        function showTab(tabName) {
            // Hide all sections
            document.querySelectorAll('.diagram-section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // Show selected section
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked button
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
